"use strict";var h_=Object.create;var B=Object.defineProperty;var c_=Object.getOwnPropertyDescriptor;var f_=Object.getOwnPropertyNames;var b_=Object.getPrototypeOf,k_=Object.prototype.hasOwnProperty;var w_=(_,a)=>()=>(a||_((a={exports:{}}).exports,a),a.exports),v_=(_,a)=>{for(var e in a)B(_,e,{get:a[e],enumerable:!0})},Z=(_,a,e,s)=>{if(a&&typeof a=="object"||typeof a=="function")for(let n of f_(a))!k_.call(_,n)&&n!==e&&B(_,n,{get:()=>a[n],enumerable:!(s=c_(a,n))||s.enumerable});return _};var T=(_,a,e)=>(e=_!=null?h_(b_(_)):{},Z(a||!_||!_.__esModule?B(e,"default",{value:_,enumerable:!0}):e,_)),x_=_=>Z(B({},"__esModule",{value:!0}),_);var l_=w_((N_,u_)=>{"use strict";var W=Object.defineProperty,D_=Object.getOwnPropertyDescriptor,E_=Object.getOwnPropertyNames,q_=Object.prototype.hasOwnProperty,S_=(_,a)=>{for(var e in a)W(_,e,{get:a[e],enumerable:!0})},T_=(_,a,e,s)=>{if(a&&typeof a=="object"||typeof a=="function")for(let n of E_(a))!q_.call(_,n)&&n!==e&&W(_,n,{get:()=>a[n],enumerable:!(s=D_(a,n))||s.enumerable});return _},I_=_=>T_(W({},"__esModule",{value:!0}),_),V={};S_(V,{blockskilltype:()=>a_,buffshowprioritycategory:()=>n_,hitflag:()=>F,hitoption:()=>Q,itemcategory:()=>e_,npcgrade:()=>y,npctype:()=>__,stattype:()=>g,statuseffectcategory:()=>s_,triggersignaltype:()=>X});u_.exports=I_(V);var X=(_=>(_[_.none=0]="none",_[_.out=1]="out",_[_.click_click=2]="click_click",_[_.door_open=3]="door_open",_[_.door_close=4]="door_close",_[_.switch_on=5]="switch_on",_[_.switch_off=6]="switch_off",_[_.hit_hit=7]="hit_hit",_[_.hit_destruct=8]="hit_destruct",_[_.grip_grip=9]="grip_grip",_[_.volume_enter=10]="volume_enter",_[_.volume_leave=11]="volume_leave",_[_.volume_on=12]="volume_on",_[_.volume_off=13]="volume_off",_[_.npc_spawn=14]="npc_spawn",_[_.npc_dead=15]="npc_dead",_[_.npc_event_1=16]="npc_event_1",_[_.npc_event_2=17]="npc_event_2",_[_.npc_event_3=18]="npc_event_3",_[_.npc_event_4=19]="npc_event_4",_[_.npc_event_5=20]="npc_event_5",_[_.yes=21]="yes",_[_.no=22]="no",_[_.prop_pickup=23]="prop_pickup",_[_.prop_rotate_start=24]="prop_rotate_start",_[_.prop_rotate_cancel=25]="prop_rotate_cancel",_[_.prop_rotate_end=26]="prop_rotate_end",_[_.assembled=27]="assembled",_[_.user_signal=28]="user_signal",_[_.volume_inputkey=29]="volume_inputkey",_[_.shared_click=30]="shared_click",_[_.shared_despawn=31]="shared_despawn",_[_.dungeon_cleared=32]="dungeon_cleared",_[_.coop_quest_start=33]="coop_quest_start",_[_.coop_quest_complete=34]="coop_quest_complete",_[_.coop_quest_fail=35]="coop_quest_fail",_[_.user_ship_wreck=36]="user_ship_wreck",_[_.tower_hit=37]="tower_hit",_[_.tower_destruct=38]="tower_destruct",_[_.vehicle_enter=39]="vehicle_enter",_[_.vehicle_leave=40]="vehicle_leave",_[_.instancezone_load_complete=41]="instancezone_load_complete",_[_.random_case_1=42]="random_case_1",_[_.random_case_2=43]="random_case_2",_[_.random_case_3=44]="random_case_3",_[_.random_case_4=45]="random_case_4",_[_.random_case_5=46]="random_case_5",_[_.npc_pathevent=47]="npc_pathevent",_[_.joint_attach=48]="joint_attach",_[_.joint_detach=49]="joint_detach",_[_.hit_on2=50]="hit_on2",_[_.hit_on3=51]="hit_on3",_[_.coop_quest_cancel=52]="coop_quest_cancel",_[_.dungeon_enter=53]="dungeon_enter",_[_.station_disable=54]="station_disable",_[_.all_dead=55]="all_dead",_[_.all_exit=56]="all_exit",_[_.dungeon_phase1_clear=57]="dungeon_phase1_clear",_[_.dungeon_phase1_fail=58]="dungeon_phase1_fail",_[_.dungeon_phase2_clear=59]="dungeon_phase2_clear",_[_.dungeon_phase2_fail=60]="dungeon_phase2_fail",_[_.dungeon_phase3_clear=61]="dungeon_phase3_clear",_[_.dungeon_phase3_fail=62]="dungeon_phase3_fail",_[_.dungeon_phase4_clear=63]="dungeon_phase4_clear",_[_.dungeon_phase4_fail=64]="dungeon_phase4_fail",_[_.user_status_effect=65]="user_status_effect",_[_.instance_timer_start=66]="instance_timer_start",_[_.instance_timer_end=67]="instance_timer_end",_[_.instance_timer_cancel=68]="instance_timer_cancel",_[_.instance_timer_event_1=69]="instance_timer_event_1",_[_.instance_timer_event_2=70]="instance_timer_event_2",_[_.instance_timer_event_3=71]="instance_timer_event_3",_[_.instance_timer_event_4=72]="instance_timer_event_4",_[_.instance_timer_event_5=73]="instance_timer_event_5",_[_.dungeon_phase5_clear=74]="dungeon_phase5_clear",_[_.dungeon_phase5_fail=75]="dungeon_phase5_fail",_[_.dungeon_phase6_clear=76]="dungeon_phase6_clear",_[_.dungeon_phase6_fail=77]="dungeon_phase6_fail",_[_.dungeon_phase1_resume=78]="dungeon_phase1_resume",_[_.dungeon_phase2_resume=79]="dungeon_phase2_resume",_[_.dungeon_phase3_resume=80]="dungeon_phase3_resume",_[_.dungeon_phase4_resume=81]="dungeon_phase4_resume",_[_.dungeon_phase5_resume=82]="dungeon_phase5_resume",_[_.dungeon_phase6_resume=83]="dungeon_phase6_resume",_[_.track_move_start_1=84]="track_move_start_1",_[_.track_move_start_2=85]="track_move_start_2",_[_.track_move_start_3=86]="track_move_start_3",_[_.track_move_failure=87]="track_move_failure",_[_.hit_restore_start=88]="hit_restore_start",_[_.hit_restore_finish=89]="hit_restore_finish",_[_.zone_level_normal=90]="zone_level_normal",_[_.zone_level_hard=91]="zone_level_hard",_[_.zone_level_hellchaos=92]="zone_level_hellchaos",_[_.zone_level_challenge=93]="zone_level_challenge",_[_.zone_level_special=94]="zone_level_special",_[_.occupation_none_to_red=95]="occupation_none_to_red",_[_.occupation_none_to_blue=96]="occupation_none_to_blue",_[_.occupation_blue_to_red=97]="occupation_blue_to_red",_[_.occupation_red_to_blue=98]="occupation_red_to_blue",_[_.instance_timer_event_6=99]="instance_timer_event_6",_[_.instance_timer_event_7=100]="instance_timer_event_7",_[_.instance_timer_event_8=101]="instance_timer_event_8",_[_.instance_timer_event_9=102]="instance_timer_event_9",_[_.instance_timer_event_10=103]="instance_timer_event_10",_[_.user_status_effect_removed=104]="user_status_effect_removed",_))(X||{}),F=(_=>(_[_.normal=0]="normal",_[_.critical=1]="critical",_[_.miss=2]="miss",_[_.invincible=3]="invincible",_[_.dot=4]="dot",_[_.immune=5]="immune",_[_.immune_silenced=6]="immune_silenced",_[_.font_silenced=7]="font_silenced",_[_.dot_critical=8]="dot_critical",_[_.dodge=9]="dodge",_[_.reflect=10]="reflect",_[_.damage_share=11]="damage_share",_[_.dodge_hit=12]="dodge_hit",_))(F||{}),Q=(_=>(_[_.back_attack=0]="back_attack",_[_.frontal_attack=1]="frontal_attack",_[_.flank_attack=2]="flank_attack",_))(Q||{}),g=(_=>(_[_.none=0]="none",_[_.hp=1]="hp",_[_.mp=2]="mp",_[_.str=3]="str",_[_.agi=4]="agi",_[_.int=5]="int",_[_.con=6]="con",_[_.str_x=7]="str_x",_[_.agi_x=8]="agi_x",_[_.int_x=9]="int_x",_[_.con_x=10]="con_x",_[_.criticalhit=15]="criticalhit",_[_.specialty=16]="specialty",_[_.oppression=17]="oppression",_[_.rapidity=18]="rapidity",_[_.endurance=19]="endurance",_[_.mastery=20]="mastery",_[_.criticalhit_x=21]="criticalhit_x",_[_.specialty_x=22]="specialty_x",_[_.oppression_x=23]="oppression_x",_[_.rapidity_x=24]="rapidity_x",_[_.endurance_x=25]="endurance_x",_[_.mastery_x=26]="mastery_x",_[_.max_hp=27]="max_hp",_[_.max_mp=28]="max_mp",_[_.max_hp_x=29]="max_hp_x",_[_.max_mp_x=30]="max_mp_x",_[_.max_hp_x_x=31]="max_hp_x_x",_[_.max_mp_x_x=32]="max_mp_x_x",_[_.normal_hp_recovery=33]="normal_hp_recovery",_[_.combat_hp_recovery=34]="combat_hp_recovery",_[_.normal_hp_recovery_rate=35]="normal_hp_recovery_rate",_[_.combat_hp_recovery_rate=36]="combat_hp_recovery_rate",_[_.normal_mp_recovery=37]="normal_mp_recovery",_[_.combat_mp_recovery=38]="combat_mp_recovery",_[_.normal_mp_recovery_rate=39]="normal_mp_recovery_rate",_[_.combat_mp_recovery_rate=40]="combat_mp_recovery_rate",_[_.self_recovery_rate=41]="self_recovery_rate",_[_.drain_hp_dam_rate=42]="drain_hp_dam_rate",_[_.drain_mp_dam_rate=43]="drain_mp_dam_rate",_[_.dam_reflection_rate=44]="dam_reflection_rate",_[_.char_attack_dam=47]="char_attack_dam",_[_.skill_effect_dam_addend=48]="skill_effect_dam_addend",_[_.attack_power_rate=49]="attack_power_rate",_[_.skill_damage_rate=50]="skill_damage_rate",_[_.attack_power_rate_x=51]="attack_power_rate_x",_[_.skill_damage_rate_x=52]="skill_damage_rate_x",_[_.cooldown_reduction=53]="cooldown_reduction",_[_.paralyzation_point_rate=54]="paralyzation_point_rate",_[_.def=55]="def",_[_.res=56]="res",_[_.def_x=57]="def_x",_[_.res_x=58]="res_x",_[_.def_x_x=59]="def_x_x",_[_.res_x_x=60]="res_x_x",_[_.def_pen_rate=67]="def_pen_rate",_[_.res_pen_rate=68]="res_pen_rate",_[_.physical_inc_rate=69]="physical_inc_rate",_[_.magical_inc_rate=70]="magical_inc_rate",_[_.self_shield_rate=71]="self_shield_rate",_[_.hit_rate=72]="hit_rate",_[_.dodge_rate=73]="dodge_rate",_[_.critical_hit_rate=74]="critical_hit_rate",_[_.critical_res_rate=75]="critical_res_rate",_[_.critical_dam_rate=76]="critical_dam_rate",_[_.attack_speed=77]="attack_speed",_[_.attack_speed_rate=78]="attack_speed_rate",_[_.move_speed=79]="move_speed",_[_.move_speed_rate=80]="move_speed_rate",_[_.prop_move_speed=81]="prop_move_speed",_[_.prop_move_speed_rate=82]="prop_move_speed_rate",_[_.vehicle_move_speed=83]="vehicle_move_speed",_[_.vehicle_move_speed_rate=84]="vehicle_move_speed_rate",_[_.ship_move_speed=85]="ship_move_speed",_[_.ship_move_speed_rate=86]="ship_move_speed_rate",_[_.fire_dam_rate=87]="fire_dam_rate",_[_.ice_dam_rate=88]="ice_dam_rate",_[_.electricity_dam_rate=89]="electricity_dam_rate",_[_.earth_dam_rate=91]="earth_dam_rate",_[_.dark_dam_rate=92]="dark_dam_rate",_[_.holy_dam_rate=93]="holy_dam_rate",_[_.elements_dam_rate=94]="elements_dam_rate",_[_.fire_res_rate=95]="fire_res_rate",_[_.ice_res_rate=96]="ice_res_rate",_[_.electricity_res_rate=97]="electricity_res_rate",_[_.earth_res_rate=99]="earth_res_rate",_[_.dark_res_rate=100]="dark_res_rate",_[_.holy_res_rate=101]="holy_res_rate",_[_.elements_res_rate=102]="elements_res_rate",_[_.self_cc_time_rate=105]="self_cc_time_rate",_[_.enemy_cc_time_rate=106]="enemy_cc_time_rate",_[_.identity_value1=107]="identity_value1",_[_.identity_value2=108]="identity_value2",_[_.identity_value3=109]="identity_value3",_[_.awakening_dam_rate=110]="awakening_dam_rate",_[_.item_drop_rate=111]="item_drop_rate",_[_.gold_rate=112]="gold_rate",_[_.exp_rate=113]="exp_rate",_[_.attack_power_addend=123]="attack_power_addend",_[_.npc_species_humanoid_dam_rate=125]="npc_species_humanoid_dam_rate",_[_.npc_species_devil_dam_rate=126]="npc_species_devil_dam_rate",_[_.npc_species_substance_dam_rate=127]="npc_species_substance_dam_rate",_[_.npc_species_undead_dam_rate=128]="npc_species_undead_dam_rate",_[_.npc_species_plant_dam_rate=129]="npc_species_plant_dam_rate",_[_.npc_species_insect_dam_rate=130]="npc_species_insect_dam_rate",_[_.npc_species_spirit_dam_rate=131]="npc_species_spirit_dam_rate",_[_.npc_species_wild_beast_dam_rate=132]="npc_species_wild_beast_dam_rate",_[_.npc_species_mechanic_dam_rate=133]="npc_species_mechanic_dam_rate",_[_.npc_species_ancient_dam_rate=134]="npc_species_ancient_dam_rate",_[_.npc_species_god_dam_rate=135]="npc_species_god_dam_rate",_[_.npc_species_archfiend_dam_rate=136]="npc_species_archfiend_dam_rate",_[_.vitality=137]="vitality",_[_.ship_booter_speed=138]="ship_booter_speed",_[_.ship_wreck_speed_rate=139]="ship_wreck_speed_rate",_[_.island_speed_rate=140]="island_speed_rate",_[_.attack_power_sub_rate_1=141]="attack_power_sub_rate_1",_[_.attack_power_sub_rate_2=142]="attack_power_sub_rate_2",_[_.physical_inc_sub_rate_1=143]="physical_inc_sub_rate_1",_[_.physical_inc_sub_rate_2=144]="physical_inc_sub_rate_2",_[_.magical_inc_sub_rate_1=145]="magical_inc_sub_rate_1",_[_.magical_inc_sub_rate_2=146]="magical_inc_sub_rate_2",_[_.skill_damage_sub_rate_1=147]="skill_damage_sub_rate_1",_[_.skill_damage_sub_rate_2=148]="skill_damage_sub_rate_2",_[_.resource_recovery_rate=149]="resource_recovery_rate",_[_.weapon_dam=151]="weapon_dam",_))(g||{}),y=(_=>(_[_.none=0]="none",_[_.underling=1]="underling",_[_.normal=2]="normal",_[_.elite=3]="elite",_[_.named=4]="named",_[_.seed=5]="seed",_[_.boss=6]="boss",_[_.raid=7]="raid",_[_.lucky=8]="lucky",_[_.epic_raid=9]="epic_raid",_[_.commander=10]="commander",_))(y||{}),__=(_=>(_[_.monster=0]="monster",_[_.townsfolk=1]="townsfolk",_[_.summoned=2]="summoned",_[_.totem=3]="totem",_[_.mercenary=4]="mercenary",_[_.pet=5]="pet",_[_.monster_pc_form=6]="monster_pc_form",_))(__||{}),e_=(_=>(_[_.na=0]="na",_[_.equip_weapon_sword=10101]="equip_weapon_sword",_[_.equip_weapon_hammer=10102]="equip_weapon_hammer",_[_.equip_weapon_gunlance=10103]="equip_weapon_gunlance",_[_.equip_weapon_bow=10104]="equip_weapon_bow",_[_.equip_weapon_gun=10105]="equip_weapon_gun",_[_.equip_weapon_launcher=10106]="equip_weapon_launcher",_[_.equip_weapon_triple_sword=10107]="equip_weapon_triple_sword",_[_.equip_weapon_no_name=10108]="equip_weapon_no_name",_[_.equip_weapon_gunblade=10109]="equip_weapon_gunblade",_[_.equip_weapon_staff1=10110]="equip_weapon_staff1",_[_.equip_weapon_staff2=10111]="equip_weapon_staff2",_[_.equip_weapon_liana_harp=10112]="equip_weapon_liana_harp",_[_.equip_weapon_heavy_gauntlet=10113]="equip_weapon_heavy_gauntlet",_[_.equip_weapon_symbol=10114]="equip_weapon_symbol",_[_.equip_weapon_element=10115]="equip_weapon_element",_[_.equip_weapon_tarot_card=10116]="equip_weapon_tarot_card",_[_.equip_weapon_geomungo=10117]="equip_weapon_geomungo",_[_.equip_weapon_ductile_gauntlet=10118]="equip_weapon_ductile_gauntlet",_[_.equip_weapon_sub_machine_gun=10119]="equip_weapon_sub_machine_gun",_[_.equip_weapon_lance=10120]="equip_weapon_lance",_[_.equip_weapon_dual_sword=10121]="equip_weapon_dual_sword",_[_.equip_weapon_demonic_weapon=10122]="equip_weapon_demonic_weapon",_[_.equip_weapon_holy_sword=10123]="equip_weapon_holy_sword",_[_.equip_weapon_dagger=10124]="equip_weapon_dagger",_[_.equip_weapon_gun_female=10125]="equip_weapon_gun_female",_[_.equip_weapon_element_male=10126]="equip_weapon_element_male",_[_.equip_weapon_giant_staff=10127]="equip_weapon_giant_staff",_[_.equip_weapon_pen=10128]="equip_weapon_pen",_[_.equip_weapon_umbrella=10129]="equip_weapon_umbrella",_[_.equip_weapon_sword_female=10130]="equip_weapon_sword_female",_[_.equip_armor_helmet=10201]="equip_armor_helmet",_[_.equip_armor_top=10202]="equip_armor_top",_[_.equip_armor_pants=10203]="equip_armor_pants",_[_.equip_armor_glove=10204]="equip_armor_glove",_[_.equip_armor_pauldron=10205]="equip_armor_pauldron",_[_.equip_accessory_necklace=10401]="equip_accessory_necklace",_[_.equip_accessory_earring=10402]="equip_accessory_earring",_[_.equip_accessory_ring=10403]="equip_accessory_ring",_[_.equip_accessory_bracelet=10404]="equip_accessory_bracelet",_[_.equip_ability_stone=10500]="equip_ability_stone",_[_.equip_assistance_voyage=10601]="equip_assistance_voyage",_[_.equip_assistance_life=10602]="equip_assistance_life",_[_.equip_assistance_combat=10603]="equip_assistance_combat",_[_.equip_etc_talisman=10701]="equip_etc_talisman",_[_.life_tool_glove=20101]="life_tool_glove",_[_.life_tool_axe=20102]="life_tool_axe",_[_.life_tool_pickaxe=20103]="life_tool_pickaxe",_[_.life_tool_machete=20104]="life_tool_machete",_[_.life_tool_fishingrod=20105]="life_tool_fishingrod",_[_.life_tool_shovel=20106]="life_tool_shovel",_[_.life_tool_marble=20107]="life_tool_marble",_[_.life_tool_perfume=20108]="life_tool_perfume",_[_.life_tool_saw=20109]="life_tool_saw",_[_.useup_potion=30100]="useup_potion",_[_.useup_food=30200]="useup_food",_[_.useup_misc=30300]="useup_misc",_[_.useup_misc_revive_coin=30301]="useup_misc_revive_coin",_[_.useup_misc_messenger_medal=30302]="useup_misc_messenger_medal",_[_.useup_misc_pheon=30303]="useup_misc_pheon",_[_.useup_battle_item_common=30401]="useup_battle_item_common",_[_.useup_battle_item_dungeon=30402]="useup_battle_item_dungeon",_[_.useup_battle_item_raid=30403]="useup_battle_item_raid",_[_.useup_battle_item_common_attack=30411]="useup_battle_item_common_attack",_[_.useup_battle_item_dungeon_attack=30412]="useup_battle_item_dungeon_attack",_[_.useup_battle_item_common_buff=30421]="useup_battle_item_common_buff",_[_.useup_battle_item_dungeon_buff=30422]="useup_battle_item_dungeon_buff",_[_.useup_battle_item_common_function=30431]="useup_battle_item_common_function",_[_.useup_battle_item_dungeon_function=30432]="useup_battle_item_dungeon_function",_[_.useup_battle_item_raid_function=30433]="useup_battle_item_raid_function",_[_.useup_battle_item_common_heal=30441]="useup_battle_item_common_heal",_[_.useup_battle_item_dungeon_heal=30442]="useup_battle_item_dungeon_heal",_[_.useup_stash_expander_pc=30501]="useup_stash_expander_pc",_[_.useup_stash_expander_account=30502]="useup_stash_expander_account",_[_.useup_quest_starter=30600]="useup_quest_starter",_[_.useup_secret_dungeon_map=30700]="useup_secret_dungeon_map",_[_.useup_adv_book_collection=30801]="useup_adv_book_collection",_[_.useup_adv_book_food=30802]="useup_adv_book_food",_[_.useup_book_social_action=30901]="useup_book_social_action",_[_.useup_book_pet_social_action=30902]="useup_book_pet_social_action",_[_.useup_book_toy=30903]="useup_book_toy",_[_.useup_random_box_locked=31001]="useup_random_box_locked",_[_.useup_random_box_unlocked=31002]="useup_random_box_unlocked",_[_.useup_random_box_unlocked_weapon=31003]="useup_random_box_unlocked_weapon",_[_.useup_random_box_unlocked_armor_helmet=31004]="useup_random_box_unlocked_armor_helmet",_[_.useup_random_box_unlocked_armor_top=31005]="useup_random_box_unlocked_armor_top",_[_.useup_random_box_unlocked_armor_pants=31006]="useup_random_box_unlocked_armor_pants",_[_.useup_random_box_unlocked_armor_glove=31007]="useup_random_box_unlocked_armor_glove",_[_.useup_random_box_unlocked_armor_pauldron=31008]="useup_random_box_unlocked_armor_pauldron",_[_.useup_random_box_unlocked_accessory_necklace=31009]="useup_random_box_unlocked_accessory_necklace",_[_.useup_random_box_unlocked_accessory_earring=31010]="useup_random_box_unlocked_accessory_earring",_[_.useup_random_box_unlocked_accessory_ring=31011]="useup_random_box_unlocked_accessory_ring",_[_.useup_random_box_unlocked_equip=31012]="useup_random_box_unlocked_equip",_[_.useup_random_box_unlocked_armor=31013]="useup_random_box_unlocked_armor",_[_.useup_random_box_unlocked_accessory=31014]="useup_random_box_unlocked_accessory",_[_.useup_random_box_unlocked_enchant_stat=31031]="useup_random_box_unlocked_enchant_stat",_[_.useup_random_box_unlocked_enchant_attr=31032]="useup_random_box_unlocked_enchant_attr",_[_.useup_random_box_unlocked_enchant_immunity=31033]="useup_random_box_unlocked_enchant_immunity",_[_.useup_random_box_unlocked_enchant_species=31034]="useup_random_box_unlocked_enchant_species",_[_.useup_random_box_unlocked_gem=31040]="useup_random_box_unlocked_gem",_[_.useup_random_box_unlocked_card=31041]="useup_random_box_unlocked_card",_[_.useup_random_box_unlocked_ship_material=31042]="useup_random_box_unlocked_ship_material",_[_.useup_random_box_unlocked_avatar=31051]="useup_random_box_unlocked_avatar",_[_.useup_random_box_unlocked_material_enhance=31060]="useup_random_box_unlocked_material_enhance",_[_.useup_random_box_unlocked_vehicle=31070]="useup_random_box_unlocked_vehicle",_[_.useup_random_box_unlocked_pet=31080]="useup_random_box_unlocked_pet",_[_.useup_random_box_unlocked_abilitystone=31090]="useup_random_box_unlocked_abilitystone",_[_.useup_init_skill_battle=31101]="useup_init_skill_battle",_[_.useup_init_life_na=31201]="useup_init_life_na",_[_.useup_init_life_herbalism=31202]="useup_init_life_herbalism",_[_.useup_init_life_lumbering=31203]="useup_init_life_lumbering",_[_.useup_init_life_mining=31204]="useup_init_life_mining",_[_.useup_init_life_hunting=31205]="useup_init_life_hunting",_[_.useup_init_life_fishing=31206]="useup_init_life_fishing",_[_.useup_init_life_archaeology=31207]="useup_init_life_archaeology",_[_.useup_init_life_astrology=31208]="useup_init_life_astrology",_[_.useup_init_life_speaking=31209]="useup_init_life_speaking",_[_.useup_add_skill_point_battle=31301]="useup_add_skill_point_battle",_[_.useup_add_skill_point_life=31302]="useup_add_skill_point_life",_[_.useup_equip_preset_expander_normal=31401]="useup_equip_preset_expander_normal",_[_.useup_equip_preset_expander_premium=31402]="useup_equip_preset_expander_premium",_[_.useup_hunting_chase_key=31501]="useup_hunting_chase_key",_[_.useup_hunting_chase_secret_map=31502]="useup_hunting_chase_secret_map",_[_.useup_skillbook_normal=31601]="useup_skillbook_normal",_[_.useup_archeology_parabolic_reflector=31701]="useup_archeology_parabolic_reflector",_[_.useup_archeology_ancient_book=31702]="useup_archeology_ancient_book",_[_.useup_victory_crest_special=31801]="useup_victory_crest_special",_[_.useup_add_crew=31900]="useup_add_crew",_[_.useup_add_ship=31901]="useup_add_ship",_[_.useup_add_sail=31902]="useup_add_sail",_[_.useup_add_voyage_luck=31903]="useup_add_voyage_luck",_[_.useup_add_ship_avatar=31904]="useup_add_ship_avatar",_[_.useup_add_trophy=31905]="useup_add_trophy",_[_.useup_card=32e3]="useup_card",_[_.useup_card_exp=32001]="useup_card_exp",_[_.useup_toy=32100]="useup_toy",_[_.useup_character_tendency=32200]="useup_character_tendency",_[_.useup_honor_title=32300]="useup_honor_title",_[_.useup_vehicle=32400]="useup_vehicle",_[_.useup_engrave_book=32500]="useup_engrave_book",_[_.useup_add_permanent_attr=32600]="useup_add_permanent_attr",_[_.useup_add_permanent_attr_combat_skill=32601]="useup_add_permanent_attr_combat_skill",_[_.useup_add_permanent_attr_life_skill=32602]="useup_add_permanent_attr_life_skill",_[_.useup_add_permanent_attr_stat=32603]="useup_add_permanent_attr_stat",_[_.useup_add_permanent_attr_stat_con=32604]="useup_add_permanent_attr_stat_con",_[_.useup_add_permanent_attr_stat_criticalhit=32605]="useup_add_permanent_attr_stat_criticalhit",_[_.useup_add_permanent_attr_stat_endurance=32606]="useup_add_permanent_attr_stat_endurance",_[_.useup_add_permanent_attr_stat_mastery=32607]="useup_add_permanent_attr_stat_mastery",_[_.useup_add_permanent_attr_stat_oppression=32608]="useup_add_permanent_attr_stat_oppression",_[_.useup_add_permanent_attr_stat_rapidity=32609]="useup_add_permanent_attr_stat_rapidity",_[_.useup_add_permanent_attr_stat_specialty=32610]="useup_add_permanent_attr_stat_specialty",_[_.useup_add_permanent_attr_tendency_char=32611]="useup_add_permanent_attr_tendency_char",_[_.useup_add_permanent_attr_tendency_courage=32612]="useup_add_permanent_attr_tendency_courage",_[_.useup_add_permanent_attr_tendency_intellect=32613]="useup_add_permanent_attr_tendency_intellect",_[_.useup_add_permanent_attr_tendency_kindness=32614]="useup_add_permanent_attr_tendency_kindness",_[_.useup_secret_prop_map_normal=32701]="useup_secret_prop_map_normal",_[_.useup_secret_prop_map_voyage=32702]="useup_secret_prop_map_voyage",_[_.useup_add_max_count=32800]="useup_add_max_count",_[_.useup_add_town_resource=32900]="useup_add_town_resource",_[_.useup_add_pet=33e3]="useup_add_pet",_[_.useup_add_skill_rune=33100]="useup_add_skill_rune",_[_.useup_add_town_placement_prop=33200]="useup_add_town_placement_prop",_[_.useup_add_town_activity_point=33300]="useup_add_town_activity_point",_[_.useup_add_town_crew=33400]="useup_add_town_crew",_[_.useup_add_raid_rest_gauge=33500]="useup_add_raid_rest_gauge",_[_.useup_yoz_pot=33600]="useup_yoz_pot",_[_.useup_extend_duration_time=33700]="useup_extend_duration_time",_[_.useup_town_chef_packed_meal=33800]="useup_town_chef_packed_meal",_[_.useup_add_town_item_assmbly=33900]="useup_add_town_item_assmbly",_[_.useup_life_boosting=34e3]="useup_life_boosting",_[_.useup_exp_potion_combat=34100]="useup_exp_potion_combat",_[_.useup_paid_service_bm=34201]="useup_paid_service_bm",_[_.useup_paid_service_event=34202]="useup_paid_service_event",_[_.useup_add_money=34300]="useup_add_money",_[_.useup_add_money_trade_gold_deposit=34301]="useup_add_money_trade_gold_deposit",_[_.useup_add_money_jumping_trade_gold_deposit=34302]="useup_add_money_jumping_trade_gold_deposit",_[_.useup_emoticon=34400]="useup_emoticon",_[_.useup_exp_combat_immediately=34501]="useup_exp_combat_immediately",_[_.useup_exp_herbalism_immediately=34502]="useup_exp_herbalism_immediately",_[_.useup_exp_lumbering_immediately=34503]="useup_exp_lumbering_immediately",_[_.useup_exp_mining_immediately=34504]="useup_exp_mining_immediately",_[_.useup_exp_hunting_immediately=34505]="useup_exp_hunting_immediately",_[_.useup_exp_fishing_immediately=34506]="useup_exp_fishing_immediately",_[_.useup_exp_archaeology_immediately=34507]="useup_exp_archaeology_immediately",_[_.useup_exp_realm_immediately=34508]="useup_exp_realm_immediately",_[_.useup_add_town_jukebox_music=34600]="useup_add_town_jukebox_music",_[_.useup_add_selfie_item=34700]="useup_add_selfie_item",_[_.useup_etc_talisman=34801]="useup_etc_talisman",_[_.useup_etc_message_npc_spawn=34802]="useup_etc_message_npc_spawn",_[_.useup_gem_reward=34900]="useup_gem_reward",_[_.useup_aos_equip=35e3]="useup_aos_equip",_[_.useup_aos_useup=35100]="useup_aos_useup",_[_.quest_element=40100]="quest_element",_[_.quest_pickup=40200]="quest_pickup",_[_.quest_use=40300]="quest_use",_[_.quest_note=40400]="quest_note",_[_.quest_immediately_finish_daily=40500]="quest_immediately_finish_daily",_[_.install_crystal_ruby=50101]="install_crystal_ruby",_[_.install_crystal_sappahire=50102]="install_crystal_sappahire",_[_.install_crystal_emerald=50103]="install_crystal_emerald",_[_.install_crystal_amethyst=50104]="install_crystal_amethyst",_[_.install_crystal_topaz=50105]="install_crystal_topaz",_[_.install_crystal_opal=50106]="install_crystal_opal",_[_.install_avatar_crystal_patch=50201]="install_avatar_crystal_patch",_[_.install_gem=50300]="install_gem",_[_.general_ship_supply_normal=60100]="general_ship_supply_normal",_[_.general_ship_supply_rare=60101]="general_ship_supply_rare",_[_.general_ship_supply_elite=60102]="general_ship_supply_elite",_[_.general_lock_pick=60200]="general_lock_pick",_[_.general_etc=60300]="general_etc",_[_.general_island_hearts=60400]="general_island_hearts",_[_.general_giant_hearts=60401]="general_giant_hearts",_[_.general_great_pictures=60402]="general_great_pictures",_[_.general_voyage_adventure=60403]="general_voyage_adventure",_[_.general_worldtree_leaf=60404]="general_worldtree_leaf",_[_.general_adventure_medal=60405]="general_adventure_medal",_[_.general_orpheus_star=60406]="general_orpheus_star",_[_.general_memory_marble=60407]="general_memory_marble",_[_.general_ticket=60500]="general_ticket",_[_.general_token_item=60600]="general_token_item",_[_.general_exchange=60700]="general_exchange",_[_.general_town=60800]="general_town",_[_.general_town_reduce_item_time=60901]="general_town_reduce_item_time",_[_.general_town_reduce_res_time=60902]="general_town_reduce_res_time",_[_.general_town_reduce_install_time=60903]="general_town_reduce_install_time",_[_.general_town_reduce_research_time=60904]="general_town_reduce_research_time",_[_.general_town_reduce_mission_time=60905]="general_town_reduce_mission_time",_[_.general_town_reduce_all_time=60906]="general_town_reduce_all_time",_[_.general_raid_license_finish_1=61100]="general_raid_license_finish_1",_[_.general_raid_license_finish_2=61101]="general_raid_license_finish_2",_[_.general_raid_license_finish_3=61102]="general_raid_license_finish_3",_[_.general_raid_license_finish_4=61103]="general_raid_license_finish_4",_[_.general_raid_license_finish_5=61104]="general_raid_license_finish_5",_[_.general_raid_license_finish_6=61105]="general_raid_license_finish_6",_[_.general_raid_license_finish_7=61106]="general_raid_license_finish_7",_[_.general_raid_license_finish_8=61107]="general_raid_license_finish_8",_[_.general_raid_license_finish_9=61108]="general_raid_license_finish_9",_[_.general_raid_license_finish_10=61109]="general_raid_license_finish_10",_[_.general_warp_point_slot_expand=61200]="general_warp_point_slot_expand",_[_.general_quest_finish_daily=61300]="general_quest_finish_daily",_[_.general_secret_dungeon_map=61400]="general_secret_dungeon_map",_[_.general_gacha_ticket=61501]="general_gacha_ticket",_[_.general_gacha_mileage=61502]="general_gacha_mileage",_[_.general_ancient_orb_unidentified=61601]="general_ancient_orb_unidentified",_[_.general_ancient_orb=61602]="general_ancient_orb",_[_.general_town_token=61700]="general_town_token",_[_.general_aos_equip=61800]="general_aos_equip",_[_.material_etc=70100]="material_etc",_[_.material_life=70200]="material_life",_[_.material_life_archeology=70201]="material_life_archeology",_[_.material_life_fishing=70202]="material_life_fishing",_[_.material_life_herbalism=70203]="material_life_herbalism",_[_.material_life_hunting=70204]="material_life_hunting",_[_.material_life_lumbering=70205]="material_life_lumbering",_[_.material_life_mining=70206]="material_life_mining",_[_.material_life_etc=70207]="material_life_etc",_[_.material_assembly=70300]="material_assembly",_[_.material_token_assembly=70301]="material_token_assembly",_[_.material_awakening_skill=70400]="material_awakening_skill",_[_.material_tendency=70500]="material_tendency",_[_.material_tendency_deadline=70501]="material_tendency_deadline",_[_.material_tendency_etc=70502]="material_tendency_etc",_[_.material_enchant_catalyst=70600]="material_enchant_catalyst",_[_.material_enchant_scroll_stat=70701]="material_enchant_scroll_stat",_[_.material_enchant_scroll_attr=70702]="material_enchant_scroll_attr",_[_.material_enchant_scroll_species=70703]="material_enchant_scroll_species",_[_.material_enchant_scroll_immunity=70704]="material_enchant_scroll_immunity",_[_.material_enchant_scroll_any=70705]="material_enchant_scroll_any",_[_.material_enchant_scroll_badge=70706]="material_enchant_scroll_badge",_[_.material_enchant_additive=70800]="material_enchant_additive",_[_.material_polish_stone=71e3]="material_polish_stone",_[_.material_polish_bonus_tool=71001]="material_polish_bonus_tool",_[_.material_polish_core=71002]="material_polish_core",_[_.material_engrave_tool=71100]="material_engrave_tool",_[_.material_voyage_core=71200]="material_voyage_core",_[_.material_voyage_crew=71201]="material_voyage_crew",_[_.material_voyage_etc=71202]="material_voyage_etc",_[_.material_voyage_diving=71203]="material_voyage_diving",_[_.material_voyage_fishing_school=71204]="material_voyage_fishing_school",_[_.material_voyage_hunting=71205]="material_voyage_hunting",_[_.material_voyage_treasure_point=71206]="material_voyage_treasure_point",_[_.material_voyage_wrecked_ship=71207]="material_voyage_wrecked_ship",_[_.material_card_etc=71300]="material_card_etc",_[_.material_arcrasium=71400]="material_arcrasium",_[_.material_adv_book_food=71500]="material_adv_book_food",_[_.material_raid=71600]="material_raid",_[_.material_island=71700]="material_island",_[_.material_island_token=71701]="material_island_token",_[_.material_enhance_levelup=71801]="material_enhance_levelup",_[_.material_enhance_additive=71802]="material_enhance_additive",_[_.material_sealing_tool=71900]="material_sealing_tool",_[_.material_magic_scroll_weapon=72001]="material_magic_scroll_weapon",_[_.material_magic_scroll_armor_top=72002]="material_magic_scroll_armor_top",_[_.material_magic_scroll_armor_glove=72003]="material_magic_scroll_armor_glove",_[_.material_magic_scroll_enhance_material=72100]="material_magic_scroll_enhance_material",_[_.material_magic_scroll_craft_material=72200]="material_magic_scroll_craft_material",_[_.material_upgrade_tool=72300]="material_upgrade_tool",_[_.material_calibrate_tool=72400]="material_calibrate_tool",_[_.material_option_transfer_tool=72500]="material_option_transfer_tool",_[_.material_socket_adjust_tool=72600]="material_socket_adjust_tool",_[_.material_socket_amplify_tool=72700]="material_socket_amplify_tool",_[_.material_option_extract_tool=72800]="material_option_extract_tool",_[_.material_town_mana=72900]="material_town_mana",_[_.material_avatar_composite=73e3]="material_avatar_composite",_[_.material_town_farm=73100]="material_town_farm",_[_.material_town_herbalism=73101]="material_town_herbalism",_[_.material_town_mining=73102]="material_town_mining",_[_.material_town_lumbering=73103]="material_town_lumbering",_[_.material_town_hunting=73104]="material_town_hunting",_[_.material_town_fishing=73105]="material_town_fishing",_[_.material_town_archeology=73106]="material_town_archeology",_[_.material_life_tool=73200]="material_life_tool",_[_.material_town_life_tool=73300]="material_town_life_tool",_[_.material_esther_enhance=73400]="material_esther_enhance",_[_.material_exp_potion_pet=73500]="material_exp_potion_pet",_[_.material_grow_pet=73501]="material_grow_pet",_[_.material_event=73600]="material_event",_[_.material_reward=73700]="material_reward",_[_.music_instrument=80100]="music_instrument",_[_.music_note=80200]="music_note",_[_.avatar_clothes_head=90101]="avatar_clothes_head",_[_.avatar_clothes_top=90102]="avatar_clothes_top",_[_.avatar_clothes_pants=90103]="avatar_clothes_pants",_[_.avatar_clothes_face1=90104]="avatar_clothes_face1",_[_.avatar_clothes_face2=90105]="avatar_clothes_face2",_[_.avatar_clothes_instrument=90106]="avatar_clothes_instrument",_[_.avatar_clothes_dress=90107]="avatar_clothes_dress",_[_.avatar_clothes_head_set=90108]="avatar_clothes_head_set",_[_.avatar_weapon_sword=90201]="avatar_weapon_sword",_[_.avatar_weapon_hammer=90202]="avatar_weapon_hammer",_[_.avatar_weapon_gunlance=90203]="avatar_weapon_gunlance",_[_.avatar_weapon_bow=90204]="avatar_weapon_bow",_[_.avatar_weapon_gun=90205]="avatar_weapon_gun",_[_.avatar_weapon_launcher=90206]="avatar_weapon_launcher",_[_.avatar_weapon_triple_sword=90207]="avatar_weapon_triple_sword",_[_.avatar_weapon_no_name=90208]="avatar_weapon_no_name",_[_.avatar_weapon_gunblade=90209]="avatar_weapon_gunblade",_[_.avatar_weapon_staff1=90210]="avatar_weapon_staff1",_[_.avatar_weapon_staff2=90211]="avatar_weapon_staff2",_[_.avatar_weapon_liana_harp=90212]="avatar_weapon_liana_harp",_[_.avatar_weapon_heavy_gauntlet=90213]="avatar_weapon_heavy_gauntlet",_[_.avatar_weapon_symbol=90214]="avatar_weapon_symbol",_[_.avatar_weapon_element=90215]="avatar_weapon_element",_[_.avatar_weapon_tarot_card=90216]="avatar_weapon_tarot_card",_[_.avatar_weapon_geomungo=90217]="avatar_weapon_geomungo",_[_.avatar_weapon_ductile_gauntlet=90218]="avatar_weapon_ductile_gauntlet",_[_.avatar_weapon_sub_machine_gun=90219]="avatar_weapon_sub_machine_gun",_[_.avatar_weapon_lance=90220]="avatar_weapon_lance",_[_.avatar_weapon_dual_sword=90222]="avatar_weapon_dual_sword",_[_.avatar_weapon_demonic_weapon=90223]="avatar_weapon_demonic_weapon",_[_.avatar_weapon_holy_sword=90224]="avatar_weapon_holy_sword",_[_.avatar_weapon_dagger=90225]="avatar_weapon_dagger",_[_.avatar_weapon_gun_female=90226]="avatar_weapon_gun_female",_[_.avatar_weapon_element_male=90227]="avatar_weapon_element_male",_[_.avatar_weapon_giant_staff=90228]="avatar_weapon_giant_staff",_[_.avatar_weapon_pen=90229]="avatar_weapon_pen",_[_.avatar_weapon_umbrella=90230]="avatar_weapon_umbrella",_[_.avatar_weapon_sword_female=90231]="avatar_weapon_sword_female",_[_.avatar_effect_footstep=90301]="avatar_effect_footstep",_[_.astra_equip_will=100101]="astra_equip_will",_[_.astra_equip_belief=100102]="astra_equip_belief",_[_.astra_equip_concentration=100103]="astra_equip_concentration",_[_.astra_equip_desire=100104]="astra_equip_desire",_))(e_||{}),a_=(_=>(_[_.success=0]="success",_[_.fail=1]="fail",_[_.inprogress=2]="inprogress",_[_.start=3]="start",_))(a_||{}),n_=(_=>(_[_.pet=0]="pet",_[_.classskill=1]="classskill",_[_.ability=2]="ability",_[_.set=3]="set",_[_.cook=4]="cook",_[_.identity=5]="identity",_[_.bracelet=6]="bracelet",_[_.battleitem=7]="battleitem",_[_.etc=8]="etc",_))(n_||{}),s_=(_=>(_[_.buff=0]="buff",_[_.debuff=1]="debuff",_))(s_||{})});var A_={};v_(A_,{fileParserWorker:()=>P_});module.exports=x_(A_);var d_=T(require("dayjs"));var I=require("lodash"),r_=require("events"),u=T(l_());var H_=require("lodash");function d(_,a=0,e=10,s=!1){if(typeof _=="number")return isNaN(_)?a:_;let n;try{n=s?parseFloat(_):parseInt(_,e),isNaN(n)&&(n=a)}catch{n=a}return n}var p=class{lineSplit;timestamp;constructor(a){this.lineSplit=a,this.timestamp=new Date(this.lineSplit[1])}},L=class extends p{message;constructor(a){super(a),this.message=this.lineSplit[2]}},P=class extends p{playerId;constructor(a){super(a),this.playerId=a[2]}},A=class extends p{phaseCode;constructor(a){super(a),this.phaseCode=d(a[2])}},O=class extends p{id;name;classId;class;gearScore;currentHp;maxHp;constructor(a){super(a),this.id=a[2],this.name=a[3]||"Unknown Entity",this.classId=d(a[4]),this.class=a[5]||"UnknownClass",this.gearScore=d(a[7],0,10,!0),this.currentHp=d(a[8]),this.maxHp=d(a[9])}},N=class extends p{id;npcId;name;currentHp;maxHp;constructor(a){super(a),this.id=a[2],this.npcId=d(a[3]),this.name=a[4]||"Unknown Entity",this.currentHp=d(a[5]),this.maxHp=d(a[6])}},M=class extends p{id;name;killerId;killerName;constructor(a){super(a),this.id=a[2],this.name=a[3]||"Unknown Entity",this.killerId=a[4],this.killerName=a[5]||"Unknown Entity"}},H=class extends p{id;name;skillId;skillName;constructor(a){super(a),this.id=a[2],this.name=a[3]||"Unknown Entity",this.skillId=d(a[4]),this.skillName=a[5]||"Unknown Skill"}},C=class extends p{id;name;skillId;skillName;skillStage;constructor(a){super(a),this.id=a[2],this.name=a[3]||"Unknown Entity",this.skillId=a[4],this.skillName=a[5]||"Unknown Skill",this.skillStage=d(a[6])}},R=class extends p{id;name;skillId;skillName;skillEffectId;skillEffect;targetId;targetName;damage;damageModifier;currentHp;maxHp;statusEffectsOnTarget;statusEffectsOnSource;constructor(a){if(super(a),this.id=a[2],this.name=a[3]||"Unknown Entity",this.skillId=d(a[4]),this.skillName=a[5]||"Unknown Skill",this.skillEffectId=d(a[6]),this.skillEffect=a[7],this.targetId=a[8],this.targetName=a[9]||"Unknown Entity",this.damage=d(a[10]),this.damageModifier=d(a[11],0,16),this.currentHp=d(a[12]),this.maxHp=d(a[13]),this.statusEffectsOnTarget=[],this.statusEffectsOnSource=[],a.length>=17){let s=!1,n=0;for(var e of a[14].split(","))s?(this.statusEffectsOnTarget.push([n,e]),s=!1):(n=d(e),s=!0);s=!1;for(var e of a[15].split(","))s?(this.statusEffectsOnSource.push([n,e]),s=!1):(n=d(e),s=!0)}}},$=class extends p{id;name;healAmount;constructor(a){super(a),this.id=a[2],this.name=a[3]||"Unknown Entity",this.healAmount=d(a[4])}},G=class extends p{id;name;buffId;buffName;isNew;sourceId;sourceName;shieldAmount;constructor(a){super(a),this.id=a[2],this.name=a[3]||"Unknown Entity",this.buffId=a[4],this.buffName=a[5],this.isNew=a[6]=="1",this.sourceId=a[7],this.sourceName=a[8]||"Unknown Entity",this.shieldAmount=d(a[9])}},U=class extends p{id;name;constructor(a){super(a),this.id=a[2],this.name=a[3]||"Unknown Entity"}};var i_={"Serenade of Salvation":{duration:3},"Holy Aura":{duration:16e3},"Holy Protection":{duration:7e3},Demonize:{duration:1500}};function o_(){return{id:0,name:"",icon:"",damageDealt:0,damageDealtDebuffedBySupport:0,damageDealtBuffedBySupport:0,maxDamage:0,hits:{casts:0,total:0,crit:0,backAttack:0,frontAttack:0,counter:0,hitsDebuffedBySupport:0,hitsBuffedBySupport:0,hitsBuffedBy:new Map,hitsDebuffedBy:new Map},breakdown:[],damageDealtDebuffedBy:new Map,damageDealtBuffedBy:new Map}}function L_(){return{lastUpdate:0,id:"",npcId:0,name:"",class:"",classId:0,isBoss:!1,isPlayer:!1,isDead:!1,deaths:0,deathTime:0,gearScore:0,currentHp:0,maxHp:0,damageDealt:0,damageDealtDebuffedBySupport:0,damageDealtBuffedBySupport:0,healingDone:0,shieldDone:0,damageTaken:0,skills:new Map,hits:{casts:0,total:0,crit:0,backAttack:0,frontAttack:0,counter:0,hitsDebuffedBySupport:0,hitsBuffedBySupport:0,hitsBuffedBy:new Map,hitsDebuffedBy:new Map},damageDealtDebuffedBy:new Map,damageDealtBuffedBy:new Map}}var j=class extends r_.EventEmitter{resetTimer;debugLines;isLive;dontResetOnZoneChange;resetAfterPhaseTransition;splitOnPhaseTransition;removeOverkillDamage;phaseTransitionResetRequest;phaseTransitionResetRequestTime;game;encounters;healSources;meterData;constructor(a,e=!1){super(),this.meterData=a,this.resetTimer=null,this.debugLines=!1,this.isLive=e,this.dontResetOnZoneChange=!1,this.resetAfterPhaseTransition=!1,this.splitOnPhaseTransition=!1,this.removeOverkillDamage=!0,this.phaseTransitionResetRequest=!1,this.phaseTransitionResetRequestTime=0,this.resetState(),this.encounters=[],this.isLive&&setInterval(this.broadcastStateChange.bind(this),100)}updateOrCreateLocalPlayer(a){if(this.game&&a!==""){let e=this.game.entities.get(this.game.localPlayer);e?this.updateEntity(this.game.localPlayer,{id:a,name:e.name,class:e.class,classId:e.classId,isPlayer:!0,gearScore:e.gearScore}):(this.game.localPlayer="You",this.updateEntity(this.game.localPlayer,{id:a,name:"You",isPlayer:!0}))}}resetState(){this.debugLines&&this.emit("log",{type:"debug",message:"Resetting state"});let a=(0,I.cloneDeep)(this.game),e=+new Date;if(this.game={startedOn:e,lastCombatPacket:e,fightStartedOn:0,localPlayer:this.game?.localPlayer??"",currentBoss:void 0,entities:new Map,damageStatistics:{totalDamageDealt:0,topDamageDealt:0,totalDamageTaken:0,topDamageTaken:0,totalHealingDone:0,topHealingDone:0,totalShieldDone:0,topShieldDone:0,debuffs:new Map,buffs:new Map}},a&&a.localPlayer!==""){let s=a.entities.get(this.game.localPlayer);s&&this.updateEntity(s.name,{id:s.id,name:s.name,class:s.class,classId:s.classId,isPlayer:!0,gearScore:s.gearScore})}this.healSources=[],this.emit("reset-state",a)}softReset(){this.resetTimer=null;let a=(0,I.cloneDeep)(this.game.entities),e=(0,I.cloneDeep)(this.game.currentBoss);this.resetState(),a.forEach(s=>{let n=this.updateEntity(s.name,{name:s.name,npcId:s.npcId,class:s.class,classId:s.classId,isPlayer:s.isPlayer,gearScore:s.gearScore,maxHp:s.maxHp,currentHp:s.currentHp});n.name===e?.name&&(this.game.currentBoss=n)})}cancelReset(){this.resetTimer&&clearTimeout(this.resetTimer),this.resetTimer=null}splitEncounter(a=!1){let e=(0,I.cloneDeep)(this.game);e.fightStartedOn!=0&&(e.damageStatistics.totalDamageDealt!=0||e.damageStatistics.totalDamageTaken)&&this.encounters.push(e),a?this.softReset():this.resetState()}broadcastStateChange(){let a={...this.game};a.entities=new Map,this.game.entities.forEach((e,s,n)=>{if(!e.isPlayer)return;let l={...e};l.skills=new Map(e.skills),l.skills.forEach(t=>{t.breakdown=[]}),a.entities.set(s,l)}),this.emit("state-change",a)}parseLogLine(a){if(!a)return;let e=a.trim().split("|");if(e.length<1||!e[0])return;let s=d(e[0]);try{switch(s){case 0:this.onMessage(e);break;case 1:this.onInitEnv(e);break;case 2:this.onPhaseTransition(e);break;case 3:this.onNewPc(e);break;case 4:this.onNewNpc(e);break;case 5:this.onDeath(e);break;case 6:this.onSkillStart(e);break;case 7:this.onSkillStage(e);break;case 8:this.onDamage(e);break;case 9:this.onHeal(e);break;case 10:this.onBuff(e);break;case 12:this.onCounterattack(e);break}}catch(n){this.emit("log",{type:"error",message:n})}}updateEntity(a,e){let s={lastUpdate:+new Date},n=this.game.entities.get(a);return n?Object.assign(n,e,s):(n={...L_(),...e,...s},this.game.entities.set(a,n)),n}onMessage(a){let e=new L(a);this.debugLines&&this.emit("log",{type:"debug",message:`onMessage: ${e.message}`}),e.message.startsWith("Arguments:")||this.emit("message",e.message)}onInitEnv(a){let e=new P(a);this.debugLines&&this.emit("log",{type:"debug",message:"onInitEnv"}),this.updateOrCreateLocalPlayer(e.playerId),this.isLive?(this.game.entities.forEach((s,n,l)=>{s.name!==this.game.localPlayer&&s.hits.total===0&&l.delete(n)}),this.dontResetOnZoneChange===!1&&this.resetTimer==null&&(this.debugLines&&this.emit("log",{type:"debug",message:"Setting a reset timer"}),this.resetTimer=setTimeout(()=>{this.softReset()},6e3),this.emit("message","new-zone"))):(this.splitEncounter(),this.emit("message","new-zone"))}onPhaseTransition(a){let e=new A(a);this.debugLines&&this.emit("log",{type:"debug",message:`onPhaseTransition: ${e.phaseCode}`}),this.isLive&&(this.emit("message",`phase-transition-${e.phaseCode}`),this.resetAfterPhaseTransition&&(this.phaseTransitionResetRequest=!0,this.phaseTransitionResetRequestTime=+new Date)),!this.isLive&&this.splitOnPhaseTransition&&this.splitEncounter(!0)}onNewPc(a){let e=new O(a);if(this.debugLines&&this.emit("log",{type:"debug",message:`onNewPc: ${e.id}, ${e.name}, ${e.classId}, ${e.class}, ${e.gearScore}, ${e.currentHp}, ${e.maxHp}`}),this.game&&this.game.localPlayer!==""){let n=this.game.entities.get(this.game.localPlayer);n&&n.id===e.id&&(this.game.localPlayer=e.name)}let s={id:e.id,name:e.name,class:e.class,classId:e.classId,isPlayer:!0,...e.gearScore&&e.gearScore!=0&&{gearScore:e.gearScore},currentHp:e.currentHp,maxHp:e.maxHp};for(let[n,l]of this.game.entities)if(e.id===l.id){this.game.entities.delete(n),this.updateEntity(e.name,{...l,...s});return}this.updateEntity(e.name,s)}onNewNpc(a){let e=new N(a);this.debugLines&&this.emit("log",{type:"debug",message:`onNewNpc: ${e.id}, ${e.name}, ${e.currentHp}, ${e.maxHp}`});let s=!1,n=this.meterData.npc.get(e.npcId);n&&["boss","raid","epic_raid","commander"].includes(n.grade)&&(s=!0);let l=this.updateEntity(e.name,{id:e.id,name:e.name,npcId:e.npcId,isPlayer:!1,currentHp:e.currentHp,maxHp:e.maxHp,isBoss:s});l.isBoss&&(!this.game.currentBoss||this.game.currentBoss.currentHp===this.game.currentBoss.maxHp)&&(this.game.currentBoss=l)}onDeath(a){let e=new M(a);this.debugLines&&this.emit("log",{type:"debug",message:`onDeath: ${e.name} ${e.killerName}`});let s=this.game.entities.get(e.name),n=0;s?s.isDead?n=s.deaths:n=s.deaths+1:n=1,this.updateEntity(e.name,{name:e.name,isDead:!0,deathTime:+e.timestamp,deaths:n})}onSkillStart(a){let e=new H(a);this.debugLines&&this.emit("log",{type:"debug",message:`onSkillStart: ${e.id}, ${e.name}, ${e.skillId}, ${e.skillName}`});let s=i_[e.skillId];s&&this.healSources.push({source:e.name,expires:+e.timestamp+s.duration});let n=this.updateEntity(e.name,{name:e.name,isDead:!1});if(n){n.hits.casts+=1;let l=n.skills.get(e.skillId);l||(l={...o_(),id:e.skillId,...this.getSkillNameIcon(e.skillId,0,e.skillName)},n.skills.set(e.skillId,l)),l.hits.casts+=1}}onSkillStage(a){let e=new C(a);this.debugLines&&this.emit("log",{type:"debug",message:`onSkillStage: ${e.name}, ${e.skillId}, ${e.skillName}, ${e.skillStage}`})}onDamage(a){if(a.length<13)return;let e=new R(a);this.debugLines&&this.emit("log",{type:"debug",message:`onDamage: ${e.id}, ${e.name}, ${e.skillId}, ${e.skillName}, ${e.skillEffectId}, ${e.skillEffect}, ${e.targetId}, ${e.targetName}, ${e.damage}, ${e.currentHp}, ${e.maxHp}`}),this.phaseTransitionResetRequest&&this.phaseTransitionResetRequestTime>0&&this.phaseTransitionResetRequestTime<+new Date-8e3&&(this.softReset(),this.phaseTransitionResetRequest=!1),this.updateEntity(e.name,{id:e.id,name:e.name}),this.updateEntity(e.targetName,{id:e.targetId,name:e.targetName,currentHp:e.currentHp,maxHp:e.maxHp});let s=this.game.entities.get(e.name),n=this.game.entities.get(e.targetName);if(!s||!n)return;!n.isPlayer&&this.removeOverkillDamage&&e.currentHp<0&&(e.damage=e.damage+e.currentHp);let l=e.skillId,t=e.skillName;e.skillId===0&&e.skillEffectId!==0&&(l=e.skillEffectId,t=e.skillEffect);let i=s.skills.get(l);i||(i={...o_(),id:l,...this.getSkillNameIcon(e.skillId,e.skillEffectId,e.skillName)},s.skills.set(l,i));let x=e.damageModifier&15,D=(e.damageModifier>>4&7)-1;if(t==="Bleed"&&x===11)return;let h=x===1||x===8,k=D===0,E=D===1,f=new Set,b=new Set;e.statusEffectsOnSource.forEach(c=>{f.add(c[0])}),e.statusEffectsOnTarget.forEach(c=>{b.add(c[0])});let q=h?1:0,S=k?1:0,w=E?1:0;if(i.damageDealt+=e.damage,e.damage>i.maxDamage&&(i.maxDamage=e.damage),s.damageDealt+=e.damage,n.damageTaken+=e.damage,s.hits.total+=1,s.hits.crit+=q,s.hits.backAttack+=S,s.hits.frontAttack+=w,i.hits.total+=1,i.hits.crit+=q,i.hits.backAttack+=S,i.hits.frontAttack+=w,s.isPlayer){this.game.damageStatistics.totalDamageDealt+=e.damage,this.game.damageStatistics.topDamageDealt=Math.max(this.game.damageStatistics.topDamageDealt,s.damageDealt);let c=!1,v=!1;f.forEach(o=>{if(!this.game.damageStatistics.buffs.has(o)){let m=this.getStatusEffectHeaderData(o);m&&this.game.damageStatistics.buffs.set(o,m)}let r=this.game.damageStatistics.buffs.get(o);r&&!c&&(c=(r.buffcategory==="classskill"||r.buffcategory==="identity"||r.buffcategory==="ability")&&r.source.skill!==void 0&&r.target===1&&this.meterData.isSupportClassId(r.source.skill.classid))}),b.forEach(o=>{if(!this.game.damageStatistics.debuffs.has(o)){let m=this.getStatusEffectHeaderData(o);m&&this.game.damageStatistics.debuffs.set(o,m)}let r=this.game.damageStatistics.debuffs.get(o);r&&!v&&(v=(r.buffcategory==="classskill"||r.buffcategory==="identity"||r.buffcategory==="ability")&&r.source.skill!==void 0&&r.target===1&&this.meterData.isSupportClassId(r.source.skill.classid))});let Y=v?1:0,J=c?1:0;i.damageDealtBuffedBySupport+=c?e.damage:0,i.damageDealtDebuffedBySupport+=v?e.damage:0,f.forEach(o=>{let r=i.damageDealtBuffedBy.get(o)??0;i.damageDealtBuffedBy.set(o,r+e.damage);let m=s.damageDealtBuffedBy.get(o)??0;s.damageDealtBuffedBy.set(o,m+e.damage)}),b.forEach(o=>{let r=i.damageDealtDebuffedBy.get(o)??0;i.damageDealtDebuffedBy.set(o,r+e.damage);let m=s.damageDealtDebuffedBy.get(o)??0;s.damageDealtDebuffedBy.set(o,m+e.damage)}),s.damageDealtBuffedBySupport+=c?e.damage:0,s.damageDealtDebuffedBySupport+=v?e.damage:0,s.hits.hitsBuffedBySupport+=J,s.hits.hitsDebuffedBySupport+=Y,f.forEach(o=>{let r=s.hits.hitsBuffedBy.get(o)??0;s.hits.hitsBuffedBy.set(o,r+1);let m=i.hits.hitsBuffedBy.get(o)??0;i.hits.hitsBuffedBy.set(o,m+1)}),b.forEach(o=>{let r=s.hits.hitsDebuffedBy.get(o)??0;s.hits.hitsDebuffedBy.set(o,r+1);let m=i.hits.hitsDebuffedBy.get(o)??0;i.hits.hitsDebuffedBy.set(o,m+1)}),i.hits.hitsBuffedBySupport+=J,i.hits.hitsDebuffedBySupport+=Y;let m_={timestamp:+e.timestamp,damage:e.damage,targetEntity:n.id,isCrit:h,isBackAttack:k,isFrontAttack:E,isBuffedBySupport:c,isDebuffedBySupport:v,buffedBy:[...f],debuffedBy:[...b]};i.breakdown.push(m_)}n.isPlayer&&(this.game.damageStatistics.totalDamageTaken+=e.damage,this.game.damageStatistics.topDamageTaken=Math.max(this.game.damageStatistics.topDamageTaken,n.damageTaken)),n.isBoss&&(this.game.currentBoss=n),this.game.fightStartedOn===0&&(this.game.fightStartedOn=+e.timestamp),this.game.lastCombatPacket=+e.timestamp}onHeal(a){let e=new $(a);this.debugLines&&this.emit("log",{type:"debug",message:`onHeal: ${e.id}, ${e.name}, ${e.healAmount}`});let s="";for(let l of this.healSources)if(l.expires>=+e.timestamp){s=l.source;break}if(!s)return;let n=this.updateEntity(s,{name:s});n.healingDone+=e.healAmount,n.isPlayer&&(this.game.damageStatistics.totalHealingDone+=e.healAmount,this.game.damageStatistics.topHealingDone=Math.max(this.game.damageStatistics.topHealingDone,n.healingDone))}onBuff(a){let e=new G(a);if(this.debugLines&&this.emit("log",{type:"debug",message:`onBuff: ${e.id}, ${e.name}, ${e.buffId}, ${e.buffName}, ${e.sourceId}, ${e.sourceName}, ${e.shieldAmount}`}),e.shieldAmount&&e.isNew){let s=this.updateEntity(e.name,{name:e.name});s.shieldDone+=e.shieldAmount,s.isPlayer&&(this.game.damageStatistics.totalShieldDone+=e.shieldAmount,this.game.damageStatistics.topShieldDone=Math.max(this.game.damageStatistics.topShieldDone,s.shieldDone))}}onCounterattack(a){let e=new U(a);this.debugLines&&this.emit("log",{type:"debug",message:`onCounterattack: ${e.id}, ${e.name}`});let s=this.updateEntity(e.name,{name:e.name});s.hits.counter+=1}getSkillNameIcon(a,e,s){if(a===0&&e===0)return{name:"Bleed",icon:"buff_168.png"};if(a===0){let n=this.meterData.skillEffect.get(e);if(n&&n.itemname)return{name:n.itemname,icon:n.icon??""};if(n){if(n.sourceskill){let l=this.meterData.skill.get(n.sourceskill);if(l)return{name:l.name,icon:l.icon}}else{let l=this.meterData.skill.get(Math.floor(e/10));if(l)return{name:l.name,icon:l.icon}}return{name:n.comment}}else return{name:s}}else{let n=this.meterData.skill.get(a);return!n&&(n=this.meterData.skill.get(a-a%10),!n)?{name:s,icon:""}:n.summonsourceskill?(n=this.meterData.skill.get(n.summonsourceskill),n?{name:n.name+" (Summon)",icon:n.icon}:{name:s,icon:""}):n.sourceskill?(n=this.meterData.skill.get(n.sourceskill),n?{name:n.name,icon:n.icon}:{name:s,icon:""}):{name:n.name,icon:n.icon}}}getStatusEffectHeaderData(a){let e=this.meterData.skillBuff.get(a);if(!e||e.iconshowtype==="none")return;let s;e.buffcategory==="ability"&&[501,502,503,504,505].includes(e.uniquegroup)?s="dropsofether":s=e.buffcategory;let n={target:e.target==="none"?0:e.target==="self"?2:1,category:e.category,buffcategory:s,bufftype:this.getStatusEffectBuffTypeFlags(e),uniquegroup:e.uniquegroup,source:{name:e.name,desc:e.desc,icon:e.icon}};if(s==="classskill"||s==="identity"){let l;if(e.sourceskill)l=this.meterData.skill.get(e.sourceskill),l&&(n.source.skill=l);else{let t=Math.floor(a/100)*10;if(l=this.meterData.skill.get(t),!l){let i=Math.floor(e.uniquegroup/100)*10;l=this.meterData.skill.get(i)}l&&(n.source.skill=l)}l&&(n.source.skill=l)}else if(s==="ability"&&e.uniquegroup!==0){let l;if(e.sourceskill)l=this.meterData.skill.get(e.sourceskill),l&&(n.source.skill=l);else{let t=Math.floor(a/100)*10;if(l=this.meterData.skill.get(t),!l){let i=Math.floor(e.uniquegroup/100)*10;l=this.meterData.skill.get(i)}}l&&(n.source.skill=l)}else s==="set"&&e.setname&&(n.source.setname=e.setname);return n}getStatusEffectBuffTypeFlags(a){let e=0;return["weaken_defense","weaken_resistance","skill_damage_amplify","beattacked_damage_amplify","skill_damage_amplify_attack","directional_attack_amplify","instant_stat_amplify","attack_power_amplify","instant_stat_amplify_by_contents"].includes(a.type)?e|=1:["move_speed_down","all_speed_down"].includes(a.type)?e|=8:["reset_cooldown"].includes(a.type)?e|=128:["change_ai_point","ai_point_amplify"].includes(a.type)?e|=256:["increase_identity_gauge"].includes(a.type)&&(e|=64),a.passiveoption.forEach(s=>{if(s.type==="stat"){let n=u.stattype[s.keystat];if(!n)return;[u.stattype.mastery,u.stattype.mastery_x,u.stattype.paralyzation_point_rate].includes(n)&&(e|=256),[u.stattype.rapidity,u.stattype.rapidity_x,u.stattype.cooldown_reduction].includes(n)&&(e|=128),[u.stattype.max_mp,u.stattype.max_mp_x,u.stattype.max_mp_x_x,u.stattype.normal_mp_recovery,u.stattype.combat_mp_recovery,u.stattype.normal_mp_recovery_rate,u.stattype.combat_mp_recovery_rate,u.stattype.resource_recovery_rate].includes(n)&&(e|=64),[u.stattype.con,u.stattype.con_x,u.stattype.max_hp,u.stattype.max_hp_x,u.stattype.max_hp_x_x,u.stattype.normal_hp_recovery,u.stattype.combat_hp_recovery,u.stattype.normal_hp_recovery_rate,u.stattype.combat_hp_recovery_rate,u.stattype.self_recovery_rate,u.stattype.drain_hp_dam_rate,u.stattype.vitality].includes(n)&&(e|=16),(u.stattype.def<=n&&n<=u.stattype.magical_inc_rate||[u.stattype.endurance,u.stattype.endurance_x].includes(n))&&(a.category==="buff"&&s.value>=0||a.category==="debuff"&&s.value<=0?e|=1:e|=32),u.stattype.move_speed<=n&&n<=u.stattype.vehicle_move_speed_rate&&(e|=8),[u.stattype.attack_speed,u.stattype.attack_speed_rate,u.stattype.rapidity,u.stattype.rapidity_x].includes(n)&&(e|=4),[u.stattype.critical_hit_rate,u.stattype.criticalhit,u.stattype.criticalhit_x].includes(n)&&(e|=2),(u.stattype.attack_power_sub_rate_1<=n&&n<=u.stattype.skill_damage_sub_rate_2||u.stattype.fire_dam_rate<=n&&n<=u.stattype.elements_dam_rate||[u.stattype.str,u.stattype.agi,u.stattype.int,u.stattype.str_x,u.stattype.agi_x,u.stattype.int_x,u.stattype.char_attack_dam,u.stattype.attack_power_rate,u.stattype.skill_damage_rate,u.stattype.attack_power_rate_x,u.stattype.skill_damage_rate_x,u.stattype.hit_rate,u.stattype.dodge_rate,u.stattype.critical_dam_rate,u.stattype.awakening_dam_rate,u.stattype.attack_power_addend,u.stattype.weapon_dam].includes(n))&&(a.category==="buff"&&s.value>=0||a.category==="debuff"&&s.value<=0?e|=1:e|=32)}else if(s.type==="skill_critical_ratio")e|=2;else if(["skill_damage","class_option","skill_group_damage","skill_critical_damage","skill_penetration"].includes(s.type))a.category==="buff"&&s.value>=0||a.category==="debuff"&&s.value<=0?e|=1:e|=32;else if(["skill_cooldown_reduction","skill_group_cooldown_reduction"].includes(s.type))e|=128;else if(["skill_mana_reduction","mana_reduction"].includes(s.type))e|=64;else if(s.type==="combat_effect"){let n=this.meterData.combatEffect.get(s.keyindex);if(!n)return;n.actions.forEach(l=>{["modify_damage","modify_final_damage","modify_critical_multiplier","modify_penetration","modify_penetration_when_critical","modify_penetration_addend","modify_penetration_addend_when_critical","modify_damage_shield_multiplier"].includes(l.type)?e|=1:l.type==="modify_critical_ratio"&&(e|=2)})}}),e}};var p_=require("uuid"),z=T(require("fs")),K=T(require("path")),t_=T(require("dayjs/plugin/customParseFormat"));d_.default.extend(t_.default);function P_(_,a){try{let s=_.filename.slice(0,-4),n=s+".json",l=z.default.readFileSync(K.default.join(_.mainFolder,_.filename),"utf-8");if(!l)return a(null,"empty log");let t;if(_.meterData)t=_.meterData;else if(_.meterDataPath&&_.dbPath)t=new(require(_.meterDataPath)).MeterData,t.loadDbs(_.dbPath);else return a(null,"no meter-data");let i=new j(t,!1);_.splitOnPhaseTransition===!0&&(i.splitOnPhaseTransition=!0);let x=l.split(`
`).filter(h=>h!=null&&h!="");for(let h of x)i.parseLogLine(h);i.splitEncounter();let D=i.encounters;if(D.length>0){let h={encounters:[]};for(let k of D){let E=k.lastCombatPacket-k.fightStartedOn;if(E<=1e3)continue;let f={name:"",damageTaken:0,isPlayer:!1};k.entities.forEach(w=>{w.damageTaken>f.damageTaken&&(f={name:w.name,damageTaken:w.damageTaken,isPlayer:w.isPlayer})});let b={duration:E,mostDamageTakenEntity:f},q=(0,p_.v4)(),S=`${s}_${q}_encounter.json`;h.encounters.push({encounterId:q,encounterFile:S,...b}),z.default.writeFileSync(K.default.join(_.parsedLogFolder,S),JSON.stringify({...k,...b},e))}return z.default.writeFileSync(K.default.join(_.parsedLogFolder,n),JSON.stringify(h)),a(null,"log parsed")}return a(null,"no encounters found")}catch(s){return a(s,"log parser error")}function e(s,n){return n instanceof Map?{dataType:"Map",value:Array.from(n.entries())}:n instanceof Set?{dataType:"Set",value:Array.from(n.values())}:n}}0&&(module.exports={fileParserWorker});
